"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var buffer_1 = require("buffer");
var util_buffer_from_1 = require("@aws/util-buffer-from");
var crypto_1 = require("crypto");
var algo = 'sha256';
var Sha256 = /** @class */ (function () {
    function Sha256(secret) {
        this.hash = secret
            ? crypto_1.createHmac(algo, castSourceData(secret))
            : crypto_1.createHash(algo);
    }
    Sha256.prototype.update = function (toHash, encoding) {
        this.hash.update(castSourceData(toHash, encoding));
    };
    Sha256.prototype.digest = function () {
        return Promise.resolve(this.hash.digest());
    };
    return Sha256;
}());
exports.Sha256 = Sha256;
function castSourceData(toCast, encoding) {
    if (buffer_1.Buffer.isBuffer(toCast)) {
        return toCast;
    }
    if (typeof toCast === 'string') {
        return util_buffer_from_1.fromString(toCast, encoding);
    }
    if (ArrayBuffer.isView(toCast)) {
        return util_buffer_from_1.fromArrayBuffer(toCast.buffer, toCast.byteOffset, toCast.byteLength);
    }
    return util_buffer_from_1.fromArrayBuffer(toCast);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiL1VzZXJzL3poZWFsbGFuL0Rlc2t0b3AvYXdzLXNkay1qcy1zdGFnaW5nL2F3cy1zZGstanMtc3RhZ2luZy9wYWNrYWdlcy9jcnlwdG8tc2hhMjU2LW5vZGUvc3JjLyIsInNvdXJjZXMiOlsiaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFDQSxpQ0FBOEI7QUFDOUIsMERBQWtFO0FBQ2xFLGlDQUtnQjtBQUVoQixJQUFNLElBQUksR0FBRyxRQUFRLENBQUM7QUFFdEI7SUFHSSxnQkFBWSxNQUFtQjtRQUMzQixJQUFJLENBQUMsSUFBSSxHQUFHLE1BQU07WUFDZCxDQUFDLENBQUMsbUJBQVUsQ0FBQyxJQUFJLEVBQUUsY0FBYyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQzFDLENBQUMsQ0FBQyxtQkFBVSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzNCLENBQUM7SUFFRCx1QkFBTSxHQUFOLFVBQU8sTUFBa0IsRUFBRSxRQUFrQztRQUN6RCxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxjQUFjLENBQUMsTUFBTSxFQUFFLFFBQVEsQ0FBQyxDQUFDLENBQUM7SUFDdkQsQ0FBQztJQUVELHVCQUFNLEdBQU47UUFDSSxNQUFNLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUM7SUFDL0MsQ0FBQztJQUNMLGFBQUM7QUFBRCxDQUFDLEFBaEJELElBZ0JDO0FBaEJZLHdCQUFNO0FBa0JuQix3QkFBd0IsTUFBa0IsRUFBRSxRQUFpQjtJQUN6RCxFQUFFLENBQUMsQ0FBQyxlQUFNLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMxQixNQUFNLENBQUMsTUFBTSxDQUFDO0lBQ2xCLENBQUM7SUFFRCxFQUFFLENBQUMsQ0FBQyxPQUFPLE1BQU0sS0FBSyxRQUFRLENBQUMsQ0FBQyxDQUFDO1FBQzdCLE1BQU0sQ0FBQyw2QkFBVSxDQUFDLE1BQU0sRUFBRSxRQUFRLENBQUMsQ0FBQztJQUN4QyxDQUFDO0lBRUQsRUFBRSxDQUFDLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDN0IsTUFBTSxDQUFDLGtDQUFlLENBQ2xCLE1BQU0sQ0FBQyxNQUFNLEVBQ2IsTUFBTSxDQUFDLFVBQVUsRUFDakIsTUFBTSxDQUFDLFVBQVUsQ0FDcEIsQ0FBQztJQUNOLENBQUM7SUFFRCxNQUFNLENBQUMsa0NBQWUsQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUNuQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtIYXNoLCBTb3VyY2VEYXRhfSBmcm9tICdAYXdzL3R5cGVzJztcbmltcG9ydCB7QnVmZmVyfSBmcm9tICdidWZmZXInO1xuaW1wb3J0IHtmcm9tQXJyYXlCdWZmZXIsIGZyb21TdHJpbmd9IGZyb20gJ0Bhd3MvdXRpbC1idWZmZXItZnJvbSc7XG5pbXBvcnQge1xuICAgIGNyZWF0ZUhhc2gsXG4gICAgY3JlYXRlSG1hYyxcbiAgICBIYXNoIGFzIE5vZGVIYXNoLFxuICAgIEhtYWNcbn0gZnJvbSBcImNyeXB0b1wiO1xuXG5jb25zdCBhbGdvID0gJ3NoYTI1Nic7XG5cbmV4cG9ydCBjbGFzcyBTaGEyNTYgaW1wbGVtZW50cyBIYXNoIHtcbiAgICBwcml2YXRlIHJlYWRvbmx5IGhhc2g6IE5vZGVIYXNofEhtYWM7XG5cbiAgICBjb25zdHJ1Y3RvcihzZWNyZXQ/OiBTb3VyY2VEYXRhKSB7XG4gICAgICAgIHRoaXMuaGFzaCA9IHNlY3JldFxuICAgICAgICAgICAgPyBjcmVhdGVIbWFjKGFsZ28sIGNhc3RTb3VyY2VEYXRhKHNlY3JldCkpXG4gICAgICAgICAgICA6IGNyZWF0ZUhhc2goYWxnbyk7XG4gICAgfVxuXG4gICAgdXBkYXRlKHRvSGFzaDogU291cmNlRGF0YSwgZW5jb2Rpbmc/OiAndXRmOCd8J2FzY2lpJ3wnbGF0aW4xJyk6IHZvaWQge1xuICAgICAgICB0aGlzLmhhc2gudXBkYXRlKGNhc3RTb3VyY2VEYXRhKHRvSGFzaCwgZW5jb2RpbmcpKTtcbiAgICB9XG5cbiAgICBkaWdlc3QoKTogUHJvbWlzZTxVaW50OEFycmF5PiB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUodGhpcy5oYXNoLmRpZ2VzdCgpKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIGNhc3RTb3VyY2VEYXRhKHRvQ2FzdDogU291cmNlRGF0YSwgZW5jb2Rpbmc/OiBzdHJpbmcpOiBCdWZmZXIge1xuICAgIGlmIChCdWZmZXIuaXNCdWZmZXIodG9DYXN0KSkge1xuICAgICAgICByZXR1cm4gdG9DYXN0O1xuICAgIH1cblxuICAgIGlmICh0eXBlb2YgdG9DYXN0ID09PSAnc3RyaW5nJykge1xuICAgICAgICByZXR1cm4gZnJvbVN0cmluZyh0b0Nhc3QsIGVuY29kaW5nKTtcbiAgICB9XG5cbiAgICBpZiAoQXJyYXlCdWZmZXIuaXNWaWV3KHRvQ2FzdCkpIHtcbiAgICAgICAgcmV0dXJuIGZyb21BcnJheUJ1ZmZlcihcbiAgICAgICAgICAgIHRvQ2FzdC5idWZmZXIsXG4gICAgICAgICAgICB0b0Nhc3QuYnl0ZU9mZnNldCxcbiAgICAgICAgICAgIHRvQ2FzdC5ieXRlTGVuZ3RoXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGZyb21BcnJheUJ1ZmZlcih0b0Nhc3QpO1xufVxuIl19